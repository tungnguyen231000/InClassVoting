@*
    @using System.Web.Mvc;*@
@using System.Text.RegularExpressions;
@{
    ViewBag.Title = "DoQuizPaperTest";
    Layout = "~/Areas/Student/Views/Shared/_Layout.cshtml";
}

<!-- sidebar content -->
<div id="sideBar" class="relative flex flex-col flex-wrap bg-white border-r border-gray-300 p-6 flex-none w-64 animated faster">

    <div class="fixed ">
        <div>
            <!--Time CountDown-->
            <div class="topcontent w-full items-center p-6">

                <div class="text-center">
                    <span class="h4 pl-3 w-auto count-time ">TIME</span>
                </div>
                <div class="text-center">
                    <span class="h4 pl-3 w-auto count-time" size="3" type="text" id="time" name="create-question-time" placeholder="Time" data-time="@ViewBag.Time">00:00</span>
                </div>

            </div>
            <!--End Time CountDown-->
        </div>

        @if (ViewBag.MultipleQuestion.Count != 0)
        {
            int qCount = 0;
            <div class="pt-3">
                <div class="grid-container">
                    <button id="scroll-to" data-link="multiple-test" class="btn btn-bs-info w-48 hover:bg-indigo-200">Multiple Choice</button>
                </div>
                <div class="grid-container grid-cols-3">
                    @foreach (var multipleQuest in ViewBag.MultipleQuestion)
                    {
                        qCount++;
                        string dataOpt = "multiple-" + qCount;
                        <div class="grid-item"><button data-option="@dataOpt" class="btn bg-gray-200 w-full">@qCount</button></div>

                    }
                </div>
            </div>
        }


        @if (ViewBag.ReadingQuestion.Count != 0)
        {
            int qCount = 0;
            <div class="pt-3">
                <div class="grid-container">
                    <button id="scroll-to" data-link="reading-test" class="btn btn-bs-info w-48 hover:bg-indigo-200">Reading</button>
                </div>
                <div class="grid-container grid-cols-3">
                    @foreach (var readingQuest in ViewBag.ReadingQuestion)
                    {
                        qCount++;
                        string dataOpt = "reading-" + qCount;
                        <div class="grid-item"><button data-option="@dataOpt" class="btn bg-gray-200 w-full">@qCount</button></div>
                    }
                </div>
            </div>

        }

        @if (ViewBag.FillBlankQuestion.Count != 0)
        {
            int qCount = 0;
            <div class="pt-3">
                <div class="grid-container">
                    <button id="scroll-to" data-link="fillblank-test" class="btn btn-bs-info w-48 hover:bg-indigo-200">Fill Blank</button>
                </div>
                <div class="grid-container grid-cols-3">
                    @foreach (var fillBlankQuest in ViewBag.FillBlankQuestion)
                    {
                        qCount++;
                        string dataOpt = "fillblank-" + qCount;
                        <div class="grid-item"><button data-option="@dataOpt" class="btn bg-gray-200 w-full">@qCount</button></div>
                    }
                </div>
            </div>

        }

        @if (ViewBag.ShortAnswerQuestion.Count != 0)
        {
            int qCount = 0;
            <div class="pt-3">
                <div class="grid-container">
                    <button id="scroll-to" data-link="shortans-test" class="btn btn-bs-info w-48 hover:bg-indigo-200">Short Answer</button>
                </div>
                <div class="grid-container grid-cols-3">
                    @foreach (var shortAnsQuest in ViewBag.ShortAnswerQuestion)
                    {
                        qCount++;
                        string dataOpt = "short-" + qCount;
                        <div class="grid-item"><button data-option="@dataOpt" class="btn bg-gray-200 w-full">@qCount</button></div>
                    }
                </div>
            </div>

        }

        @if (ViewBag.MatchingQuestion.Count != 0)
        {
            int qCount = 0;
            <div class="pt-3">
                <div class="grid-container">
                    <button id="scroll-to" data-link="matching-test" class="btn btn-bs-info w-48 hover:bg-indigo-200">Matching</button>
                </div>
                <div class="grid-container grid-cols-3">
                    @foreach (var matchQuest in ViewBag.MatchingQuestion)
                    {
                        qCount++;
                        string dataOpt = "match-" + qCount;
                        <div class="grid-item"><button data-option="@dataOpt" class="btn bg-gray-200 w-full">qCount</button></div>
                    }
                </div>
            </div>

        }

        @if (ViewBag.IndicateMistakeQuestion.Count != 0)
        {
            int qCount = 0;
            <div class="pt-3">
                <div class="grid-container">
                    <button id="scroll-to" data-link="indicate-test" class="btn btn-bs-info w-48 hover:bg-indigo-200">Indicate Mistake</button>
                </div>
                <div class="grid-container grid-cols-3">
                    @foreach (var indicateQuest in ViewBag.IndicateMistakeQuestion)
                    {
                        qCount++;
                        string dataOpt = "indicate-" + qCount;
                        <div class="grid-item"><button data-option="@dataOpt" class="btn bg-gray-200 w-full">@qCount</button></div>
                    }
                </div>
            </div>

        }
    </div>

</div>
<!-- End sidebar -->

<div class="bg-gray-100 flex-1 p-6 md:mt-16">


    <div class="grid grid-cols-1 w-full">
        <div class="topcontent w-full items-center bg-gray p-6 ">
            <h1 class="h4 text-center">@ViewBag.Quiz.Quiz_Name</h1>
        </div>

        <!--Form Test-->
        @using (Html.BeginForm("SubmitQuiz", "Quiz", FormMethod.Post, new { id = "formPaperQuiz" }))
        {
            <input type="hidden" style="width:95%" class="w-full pl-3" name="qDoneID" value="@ViewBag.Quiz.QuizDoneID" />
            <input type="hidden" name="studentID" value="1" />
            <!--======Multiple Test=======-->
            if (ViewBag.MultipleQuestion.Count != 0)
            {
                <div id="multiple-test" class="w-full items-center bg-gray p-6 mt-6 border border-black-400 bg-gray-200">
                    <div class="">
                        <span class="h6">Multiple Choice</span>
                    </div>
                </div>


                <div class="w-full bg-gray p-6 border border-black-400">
                    @{ int countMultipleQuestion = 0;
                    }
                    @foreach (var question in ViewBag.MultipleQuestion)
                    {
                        countMultipleQuestion++;
                        <div class="w-full items-center bg-gray p-6 ">
                            <span>
                                Question @countMultipleQuestion:  <span />
                                <span></span>
                        </div>
                        <div class="w-full items-center bg-gray  ">
                            <div>
                                <div contenteditable="false" class="w-full bg-gray p-6 font-sans font-semibold">
                                    @question.Text
                                </div>
                                @if (question.ImageData != null)
                                {
                                    var base64 = Convert.ToBase64String(question.ImageData);
                                    var imgSrc = string.Format("data:image/png;base64,{0}", base64);
                                    <div class="w-full bg-gray p-6">
                                        <img src="@imgSrc" class="block ml-auto mr-auto" alt="pic" />
                                    </div>
                                }

                            </div>
                            <input type="hidden" name="qid" value="@question.Q_DoneID" />
                            <input type="hidden" name="qtype" value="1" />

                        </div>

                        <div class="w-full items-center bg-gray">
                            <table class="w-full border-spacing-2">
                                @{
                                    int countAnswer = 0;
                                }
                                @foreach (var answers in question.QuestionAnswerDones)
                                {
                                    countAnswer++;
                                    string dataOpt = "multiple-" + countMultipleQuestion;
                                    <tr>
                                        <td class="w-2">
                                            @*<input type="hidden" name="numberOfAnswer" value="@countAnswer">*@
                                            <input type="checkbox" id="@dataOpt" name="cbMultipleOption" value="@answers.QA_DoneID">
                                        </td>
                                        <td>
                                            @if (countAnswer == 1)
                                            {<label>A.</label>}
                                            else if (countAnswer == 2)
                                            {<label>B.</label>}
                                            else if (countAnswer == 3)
                                            {<label>C.</label>}
                                            else if (countAnswer == 4)
                                            {<label>D.</label>}
                                            else if (countAnswer == 5)
                                            {<label>E.</label>}
                                            else if (countAnswer == 6)
                                            {<label>F.</label>}
                                            &nbsp;
                                            <input type="text" style="width:95%" class="w-full pl-3 bg-gray-100" name="multipleOption" value="@answers.Text" readonly>
                                        </td>
                                    </tr>

                                }
                            </table>
                        </div>
                        if (countMultipleQuestion < ViewBag.MultipleQuestion.Count)
                        {
                            <hr />
                        }
                    }
                </div>
            }

            <!--=======End Multiple Test=======-->

            <!--=======Reading Test========-->
            if (ViewBag.ReadingQuestion.Count != 0)
            {
                <div id="reading-test" class="w-full items-center bg-gray p-6 mt-6 border border-black-400 bg-gray-200">
                    <div class="">
                        <span class="h6">Reading</span>
                    </div>
                </div>

                <div class="w-full bg-gray p-6 border border-black-400">
                    @{ int countReadingQuestion = 0;
                    }
                    @foreach (var question in ViewBag.ReadingQuestion)
                    {
                        countReadingQuestion++;
                        <div>
                            <div class="w-full items-center bg-gray p-6">
                                <span>Question @countReadingQuestion:</span>
                            </div>

                            <div class="w-full items-center bg-gray  ">
                                @if (question.PassageID != null)
                                {
                                    <div>
                                        <div contenteditable="false" class="w-full items-center bg-gray p-6 ">
                                            @question.Passage_Done.Text

                                        </div>
                                    </div>
                                }
                                @if (question.ImageData != null)
                                {
                                    var base64 = Convert.ToBase64String(question.ImageData);
                                    var imgSrc = string.Format("data:image/png;base64,{0}", base64);
                                    <div class="w-full bg-gray p-6">
                                        <img src="@imgSrc" class="block ml-auto mr-auto" alt="pic" />
                                    </div>
                                }
                            </div>
                            <div class="w-full items-center bg-gray ">
                                <div class="">
                                    <div contenteditable="false" class="w-full items-center bg-gray p-6 font-sans font-semibold ">
                                        @question.Text
                                    </div>

                                    <input type="hidden" name="qid" value="@question.Q_DoneID" />
                                    <input type="hidden" name="qtype" value="2" />
                                </div>

                            </div>

                            <div class="w-full items-center bg-gray ">
                                <table class="w-full border-spacing-2">
                                    @{
                                        int countAnswer = 0;
                                    }
                                    @foreach (var answers in question.QuestionAnswerDones)
                                    {
                                        countAnswer++;
                                        string dataOpt = "reading-" + countReadingQuestion;
                                        <tr>
                                            <td class="w-2">
                                                @*<input type="hidden" name="numberOfAnswer" value="@countAnswer">*@
                                                <input type="checkbox" id="@dataOpt" name="cbReadingOption" value="@answers.QA_DoneID">
                                            </td>
                                            <td>
                                                @if (countAnswer == 1)
                                                {<label>A.</label>}
                                                else if (countAnswer == 2)
                                                {<label>B.</label>}
                                                else if (countAnswer == 3)
                                                {<label>C.</label>}
                                                else if (countAnswer == 4)
                                                {<label>D.</label>}
                                                else if (countAnswer == 5)
                                                {<label>E.</label>}
                                                else if (countAnswer == 6)
                                                {<label>F.</label>}
                                                &nbsp;
                                                <input type="text" style="width:95%" class="w-full pl-3 bg-gray-100" name="readingOption" value="@answers.Text" readonly>
                                            </td>
                                        </tr>
                                    }
                                </table>
                            </div>
                            @if (countReadingQuestion < ViewBag.ReadingQuestion.Count)
                            {
                                <hr />
                            }

                        </div>
                    }
                </div>
            }


            <!--========End Reading Test==========-->

            <!--=======Fill Blank=======-->
            if (ViewBag.FillBlankQuestion.Count != 0)
            {
                <div id="fillblank-test" class="w-full items-center bg-gray p-6 mt-6 border border-black-400 bg-gray-200">
                    <div class="">
                        <span class="h6">Fill Blank</span>
                    </div>
                </div>

                <div class="w-full bg-gray p-6 border border-black-400">
                    @{ int countFillBlankQuestion = 0;
                    }
                    @foreach (var question in ViewBag.FillBlankQuestion)
                    {
                        countFillBlankQuestion++;
                        string dataOpt = "fillblank-" + countFillBlankQuestion;
                        <div class="w-full items-center bg-gray p-6 ">
                            <span>
                                Question @countFillBlankQuestion:  <span />
                                <span></span>
                        </div>
                        <input type="hidden" name="qid" value="@question.Q_DoneID" />
                        <input type="hidden" name="qtype" value="3" />
                        if (question.GivenWord == false)
                        {
                            string[] questionSplit = Regex.Split(question.Text, @"\(.*?\)");
                            <div contenteditable="false" id="fill-content" class="w-full items-center bg-gray p-6 ">
                                @for (int i = 0; i < questionSplit.Length; i++)
                                {
                                    <span>@questionSplit[i]</span>
                                    if (i < questionSplit.Length - 1)
                                    {
                                        <input type="text" id="@dataOpt" style="width:15%;color:blue" name="fillBankNotGivenAnswer" placeholder="...">
                                    }

                                }
                            </div>
                        }
                        else
                        {
                            List<string> answerList = new List<string>();
                            Regex regex = new Regex(@"\(([^()]+)\)*");
                            foreach (Match match in regex.Matches(question.Text))
                            {
                                string ansList = match.Value;
                                string choices = ansList.Trim().Substring(2, ansList.Length - 3);
                                answerList.Add(choices);
                            }
                            string[] questionSplit = Regex.Split(question.Text, @"\(.*?\)");
                            <div contenteditable="false" id="fill-content" class="w-full items-center bg-gray p-6 ">
                                @for (int i = 0; i < questionSplit.Length; i++)
                                {
                                    <span>@questionSplit[i]</span>
                                    if (i < questionSplit.Length - 1)
                                    {
                                        <select id="@dataOpt" style="width:15%;color:blue" name="fillBankGivenAnswer">
                                            <option value="-1" style="color:gray" selected disabled>Select one answer </option>
                                            @{
                                                string[] options = answerList[i].Split(new char[] { '~' });
                                            }
                                            @foreach (string option in options)
                                            {
                                                if (option.Contains("="))
                                                {
                                                    string newOpt = option.Substring(1, option.Length - 1);
                                                    <option value="@newOpt">@newOpt</option>

                                                }
                                                else
                                                {
                                                    <option value="@option">@option</option>
                                                }

                                            }

                                        </select>
                                    }

                                }
                            </div>
                        }
                        if (countFillBlankQuestion < ViewBag.FillBlankQuestion.Count)
                        {
                            <hr />
                        }

                    }

                </div>

            }

            <!--=======End Fill Blank=======-->


            <!--======Short Answer=======-->
            if (ViewBag.ShortAnswerQuestion.Count != 0)
            {
                <div id="shortans-test" class="w-full items-center bg-gray p-6 mt-6 border border-black-400 bg-gray-200">
                    <div class="">
                        <span class="h6">Short Answer</span>
                    </div>
                </div>

                <div class="w-full bg-gray p-6 border border-black-400">
                    @{ int countShortAnsQuestion = 0;
                    }
                    @foreach (var question in ViewBag.ShortAnswerQuestion)
                    {
                        countShortAnsQuestion++;
                        string dataOpt = "short-" + countShortAnsQuestion;
                        <div>
                            <div class="w-full items-center bg-gray p-6 ">
                                <span>
                                    Question @countShortAnsQuestion: <span />
                            </div>
                            <div class="w-full items-center bg-gray ">
                                <div>
                                    <div class="w-full items-center p-6 ">
                                        <div contenteditable="false" class="w-full items-center bg-gray">
                                            @question.Text
                                        </div>

                                    </div>
                                    @if (question.ImageData != null)
                                    {
                                        var base64 = Convert.ToBase64String(question.ImageData);
                                        var imgSrc = string.Format("data:image/png;base64,{0}", base64);
                                        <div class="w-full bg-gray p-6">
                                            <img src="@imgSrc" class="block ml-auto mr-auto" alt="pic" />
                                        </div>
                                    }
                                </div>

                                <input type="hidden" name="qid" value="@question.Q_DoneID" />
                                <input type="hidden" name="qtype" value="4" />
                            </div>

                            <div class="w-full items-center bg-gray ">
                                <table class="w-full border-spacing-2">
                                    <tr>
                                        <td>Answer: &nbsp;<input type="text" style="width:90%" class="txt w-full pl-3" id="@dataOpt" name="txtshortAnswer" placeholder="..."></td>
                                    </tr>

                                </table>
                            </div>
                            @if (countShortAnsQuestion < ViewBag.ShortAnswerQuestion.Count)
                            {
                                <hr />
                            }
                        </div>
                    }


                </div>

            }
            <!--=======End Short Answer=======-->

            <!--======Matching=======-->
            <div>
                @*<div class="w-full items-center bg-gray p-6 mt-6 border border-black-400 bg-gray-200">
                        <div class="">
                            <span class="h6">Matching</span>
                        </div>
                    </div>

                    <div class="block border border-black-400 p-6">
                        <div id="matching-test" class="w-full items-center bg-gray p-6 ">
                            <span>
                                Question 1:  <span />
                                <span>Matching each of following card:</span>
                        </div>
                        <div class="w-full bg-gray p-6">
                            <div class="w-full bg-gray p-6 text-center flex items-center justify-center inline-block">
                                <div class="w-full">
                                    <ul class="w-1/2 float-left">

                                        <li><input type="text" class="text-center my-2 py-2 w-full  border border-black-400 bg-blue-200 pointer-events-none" name="name" value="What is your name?" /></li>

                                        <li><input type="text" class="text-center my-2 py-2 w-full  border border-black-400 bg-blue-200 pointer-events-none" name="name" value="How old are you?" /></li>

                                        <li><input type="text" class="text-center my-2 py-2 w-full  border border-black-400 bg-blue-200 pointer-events-none" name="name" value="What is your favorite?" /></li>

                                        <li><input type="text" class="text-center my-2 py-2 w-full  border border-black-400 bg-blue-200 pointer-events-none" name="name" value="How much?" /></li>

                                    </ul>

                                    <ul id="matching-change-table" class="w-1/2 float-right">

                                        <li id="matching-1"><input type="text" class="text-center my-2 py-2 w-full ui-state-default border border-black-400 bg-green-200 pointer-events-none" name="name" value="10000$" /></li>

                                        <li id="matching-1"><input type="text" class="text-center my-2 py-2 w-full ui-state-default border border-black-400 bg-green-200 pointer-events-none" name="name" value="Playing Game" /></li>

                                        <li id="matching-1"><input type="text" class="text-center my-2 py-2 w-full ui-state-default border border-black-400 bg-green-200 pointer-events-none" name="name" value="Thắng" /></li>

                                        <li id="matching-1"><input type="text" class="text-center my-2 py-2 w-full ui-state-default border border-black-400 bg-green-200 pointer-events-none" name="name" value="16" /></li>

                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                *@
            </div>
            <!--=======End Matching=======-->

            <!--=======Indicate Mistake=======-->
            if (ViewBag.IndicateMistakeQuestion.Count != 0)
            {
                <div>
                    <div id="indicate-test" class="w-full items-center bg-gray p-6 mt-6 border border-black-400 bg-gray-200">
                        <span class="h6">Indicate Mistake</span>
                    </div>
                </div>
                <div class="w-full bg-gray p-6 border border-black-400">
                    @{ int countIndicateQuestion = 0;
                    }
                    @foreach (var question in ViewBag.IndicateMistakeQuestion)
                    {
                        countIndicateQuestion++;
                        <div class="w-full items-center bg-gray p-6 ">
                            <span>Question @countIndicateQuestion:<span />
                        </div>
                        <div class="w-full items-center bg-gray  ">
                            <div>
                                <div contenteditable="false" id="indicate-content" class="w-full items-center bg-gray p-6 ">
                                    @{
                                        string[] questionSplit = Regex.Split(question.Text, @"\(.*?\)");
                                        List<string> letterRepresent = new List<string>();
                                        List<string> underLineWords = new List<string>();
                                        Regex regex = new Regex(@"\(([^()]+)\)*");
                                        foreach (Match match in regex.Matches(question.Text))
                                        {
                                            string ansList = match.Value;
                                            string choices = ansList.Trim().Substring(1, ansList.Length - 2);
                                            string[] letterAndAnswer = choices.Split(new char[] { '-' });
                                            letterRepresent.Add(letterAndAnswer[0].Trim());
                                            underLineWords.Add(letterAndAnswer[1].Trim());
                                        }
                                    }
                                    @for (int i = 0; i < questionSplit.Length; i++)
                                    {
                                        <span>@questionSplit[i]</span>
                                        if (i < questionSplit.Length - 1)
                                        {
                                            string letter = "(" + letterRepresent[i] + ")";
                                            <span style="color:blue">@letter</span> <u>@underLineWords[i]</u>
                                        }

                                    }
                                </div>
                            </div>
                            <input type="hidden" name="qid" value="@question.Q_DoneID" />
                            <input type="hidden" name="qtype" value="6" />

                        </div>

                        <div class="w-full items-center bg-gray">
                            <table class="w-full border-spacing-2">
                                @{
                                    int countAnswer = 0;
                                }
                                @foreach (var answers in question.QuestionAnswerDones)
                                {
                                    countAnswer++;
                                    string dataOpt = "indicate-" + countIndicateQuestion;
                                    <tr>
                                        <td class="w-2">
                                            @*<input type="hidden" name="numberOfAnswer" value="@countAnswer">*@
                                            <input type="checkbox" id="@dataOpt" name="cbIndicateOption" value="@answers.QA_DoneID">
                                        </td>
                                        <td>
                                            <input type="text" class="w-full pl-3 bg-gray-100" name="indicateOption" value="@answers.Text" readonly>
                                        </td>
                                    </tr>

                                }
                            </table>
                        </div>
                        if (countIndicateQuestion < ViewBag.IndicateMistakeQuestion.Count)
                        {
                            <hr />
                        }
                    }
                </div>
            }
            <!--=======End Indicate Mistake=======-->
            <div class=" inline-block mt-4">
                <input type="button" class="float-right btn btn-bs-primary" id="btnSubmit" name="name" onclick="submitPaper()" value="Finish Quiz" />
            </div>
        }
        <!--End Form Test-->
    </div>

</div>

<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script src="~/Scripts/jquery-3.4.1.js"></script>
<script src="~/Scripts/jqueryui/jquery-ui.min.js"></script>
<script src="~/Scripts/countdown.js"></script>
<script src="~/Scripts/sidebar.js"></script>
<script src="~/Scripts/more-option.js"></script>


