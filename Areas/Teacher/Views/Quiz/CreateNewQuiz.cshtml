@model dynamic

@{
    ViewBag.Title = "CreateNewQuiz";
    Layout = "~/Areas/teacher/Views/Shared/_QuizLibraryLayout.cshtml";
}

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js" integrity="sha384-qlmct0AOBiA2VPZkMY3+2WqkHtIQ9lSdAsAn5RUJD/3vA5MKDgSGcdmIv4ycVxyn" crossorigin="anonymous"></script>
<!-- Modal add question -->
<div class="modal fade" id="addQuestionModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div style="margin-right: 46%;" class="modal-dialog">
        <div style="width: 180%;" class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title h5" id="exampleModalLabel">@ViewBag.Course.Name</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

            </div>
            <div class="modal-body ">

                <div style="margin-top:10px;margin-bottom:10px" class="block-search-dropdown">
                    <div style="width: fit-content;" class="search-size text-gray-600 md:w-full md:flex md:flex-row md:justify-evenly md:pb-10
                         md:mb-10 md:border-b md:border-gray-200">

                        <div class="mr-2 transition duration-500 px-3 border-b">

                            <input class="search-box flex-1" type="text" id="searchString" placeholder="search">
                            <button type="button" onclick="reloadModalShowQuestion()" class="search-box">
                                <i class="fad fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="btn-group mg-left">

                        <input id="cidAddModal" type="hidden" value="@ViewBag.Course.CID" />
                        <h1 style="margin:auto;margin-right:10px">Chapter: </h1>
                        <select id="ddlChapter" onchange="reloadModalShowQuestion()" class="btn-indigo mg-left ">
                            <option value="-1">All Chapter </option>
                            @foreach (var chapter in ViewBag.ChapterList)
                            {
                                <option value="@chapter.ChID">@chapter.Name</option>
                            }

                        </select>
                    </div>
                    <div class="btn-group mg-left">

                        <h1 style="margin: auto; margin-right: 10px">Question Type: </h1>
                        <select id="ddlQtype" onchange="reloadModalShowQuestion()" class="btn-indigo mg-left ">
                            <option value="-1">All Type</option>
                            @foreach (var type in ViewBag.QuestionType)
                            {
                                <option value="@type.QTypeID">@type.Name</option>
                            }
                        </select>
                    </div>
                </div>
                @using (Html.BeginForm("AddQuestionToTemporaryQuiz", "Quiz", FormMethod.Post))
                {
                    <div id="divShowQuestionsForNewQuiz">
                        @{
                            Html.RenderAction("ShowQuestionForNewQuiz", "Quiz", new { chid = "-1", cid = ViewBag.Course.CID, qtype = "-1", searchText = "" });
                        }
                    </div>
                    <div class="modal-footer">
                        <input type="hidden" name="tempName" id="tempName">
                        <input type="hidden" name="cid" value="@ViewBag.Course.CID">
                        <input id="questSet" name="questSet" type="hidden" value="@ViewBag.Questions">
                        <button type="submit" class="btn btn-primary" onclick="getTempQuizInfo()">Add</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" >Close</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<!-- End Modal -->

<div class="bg-gray-100 flex-1 p-6 md:mt-16">
    <!-- start navbar -->
    <div style=" height: 63px; border-bottom: solid;">
        <div style="display: flex; height: 40px;">
            <h1 class="h5 mg-top">@ViewBag.Course.Name</h1>
            <!-- Example single danger button -->
            <p>&nbsp;</p>
        </div>
    </div>
    <div style="display: flex; height: 50px; margin-top: 15px;">
        <h1 style="margin-top:auto;margin-bottom:auto" class="h5">Quiz Name: &nbsp; </h1>
        @if (ViewBag.TempName != null)
        {
            <input style="margin-left:20px" class="fas fa-marker" type="text" id="newName" value="@ViewBag.TempName" />
        }
        else
        {
            <input style="margin-left:20px" class="fas fa-marker" type="text" id="newName" placeholder="enter name of test" />
        }

    </div>
    @if (ViewBag.CountQuest == 0)
    {
        <p style="text-align: center; margin-top: 10%; font-size: larger;">0 Questions Added...</p>
        <button type="button" class="btn-indigo mg_btn" data-bs-toggle="modal" data-bs-target="#addQuestionModal">
            Add Question
        </button>
    }
    else
    {
        <div class="tb-mg-top">
            <h1 style="margin-top:auto;margin-bottom:auto" class="h5">Question List:  </h1>

            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">No</th>
                        <th style="width: 47%;" scope="col">Question</th>
                        <th scope="col">Type</th>
                        <th scope="col">Mark</th>
                        <td scope="col"> </td>

                    </tr>
                </thead>
                <tbody>
                    @{ int countQuestion = 0;}
                    @if (Model.Questions != null)
                    {
                        foreach (var question in Model.Questions)
                        {
                            countQuestion++;
                            <tr>
                                <th scope="row">@countQuestion</th>
                                <td><a href="#" type="button">@question.Text </a></td>
                                <td>@question.QuestionType.Name</td>
                                <td>@question.Mark</td>
                                <td><a href="~/Teacher/Quiz/DeleteQuestionsInsideTemporaryQuiz?qid=@question.QID&qtype=@question.QuestionType.QTypeID&questSet=@ViewBag.Questions&cid=@ViewBag.Course.CID&tempName=@ViewBag.TempName" class="fas fa-trash-alt"></a></td>
                            </tr>
                        }
                    }
                    @if (Model.Matchings != null)
                    {
                        foreach (var match in Model.Matchings)
                        {
                            countQuestion++;
                            <tr>
                                <th scope="row">@countQuestion</th>
                                <td><a href="#" type="button">@match.ColumnA  @match.ColumnB </a></td>
                                <td>Matching</td>
                                <td>@match.Mark</td>
                                <td><a href="~/Teacher/Quiz/DeleteQuestionsInsideTemporaryQuiz?qid=@match.MID&qtype=5&questSet=@ViewBag.Questions&cid=@ViewBag.Course.CID&tempName=@ViewBag.TempName" class="fas fa-trash-alt"></a></td>
                            </tr>
                        }
                    }

                </tbody>
            </table>
            <div style="display: flex; margin-left: auto;">


                <button type="button" class="btn-indigo mg_btn" data-bs-toggle="modal" data-bs-target="#addQuestionModal">
                    Add Question
                </button>


            </div>
            @using (Html.BeginForm("CreateNewQuiz", "Quiz", FormMethod.Post))
            {
                <div style="display: flex; margin-top: 20px">

                    <div style="margin-left:30px;display:flex">
                        <input type="hidden" name="quizName" id="quizName">
                        <input type="hidden" name="questions" value="@ViewBag.Questions">
                        <input type="hidden" name="cid" value="@ViewBag.Course.CID">
                        <a>Mix Question :</a>
                            <input type="checkbox" name="cbMixQuestions" class="form-check-input" id="exampleCheck1" value="1" />
                            <input type="hidden" name="cbMixQuestions" value="0" />
                        
                            <div style="margin-left:15px">
                                <a>Number Of Random Question :</a>
                                <input name="rdQuestionNum" type="number" min="1" max="@ViewBag.CountQuest" value=""/>
                            </div>
                        
                    </div>

                </div>
                <div style="display: flex; margin-top:15px">
                    <button type="submit" onclick="getQuizName()" style="background-color: aquamarine; margin-left: auto" class="btn ">Create Test</button>
                    <a style="background-color: aquamarine; margin-left:10px " class="btn ">Cancel</a>
                </div>
            }

        </div>
    }


</div>
<!-- End General Report -->


<script type="text/javascript">

    function reloadModalShowQuestion() {
        var chid = document.getElementById("ddlChapter").value;
        var cid = document.getElementById("cidAddModal").value;
        var questions = document.getElementById("questSet").value;
        var qtype = document.getElementById("ddlQtype").value;
        var searchText = document.getElementById("searchString").value;
        console.log("jhhh" + chid + cid + questions + qtype);
        $("#divShowQuestionsForNewQuiz").load('@Url.Action("ShowQuestionForNewQuiz", "Quiz")' +
            '?chid=' + chid + '&cid=' + cid + '&qtype=' + qtype + '&searchText=' + searchText + '&questions=' + questions);
    }

    function getQuizName() {
        var newName = document.getElementById("newName").value;
        document.getElementById("quizName").value = newName;
    }

    function getTempQuizInfo() {
        console.log("hihih");

        var tempName = document.getElementById("newName").value;
        document.getElementById("tempName").value = tempName;

      

        console.log(tempName + "===" );
    }


</script>

